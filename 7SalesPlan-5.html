<!DOCTYPE html>
<html lang="zh-Hant" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>卓碼資訊 MES BOX 2025-2026 互動式作戰指揮中心</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Strategic Blue & Actionable Green -->
    <!-- Application Structure Plan: A hierarchical, drill-down dashboard designed for strategic execution. The structure follows a strict Year -> Strategy -> Quarter -> Month hierarchy as requested. 1. Annual View: High-level strategic objectives and goals, with the primary visualization being the quarterly breakdown chart reflecting the new Q1=0 ramp-up. 2. Strategy View: Detailed breakdown of the three NEW core strategies and the KPI framework. 3. Quarterly/Monthly View: An interactive tab system allowing users to drill down into the detailed monthly execution plan, with all numerical targets updated according to the revised forecast. This structure provides a seamless flow from high-level strategy to granular, daily actions. -->
    <!-- Visualization & Content Choices: 1. Quarterly Breakdown -> Goal: Inform/Track -> Viz: Combined Bar/Line Chart (Chart.js) -> Interaction: Hover for details -> Justification: Shows the revised rhythm of the year and how different metrics ramp up from Q2. 2. 2025 Execution Plan (Report Info) -> Goal: Organize/Track/Execute -> Viz: Interactive Quarterly Tabs with Monthly Tables (HTML/CSS/JS) -> Interaction: Click tabs to switch views -> Justification: Makes the dense, multi-level yearly plan easily navigable and actionable at each level. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f4f8;
            color: #1e293b;
        }
        .nav-link {
            transition: color 0.3s, border-color 0.3s;
            border-bottom: 3px solid transparent;
        }
        .nav-link.active, .nav-link:hover {
            color: #1d4ed8;
            border-bottom-color: #1d4ed8;
        }
        .content-section {
            scroll-margin-top: 80px;
        }
        .card {
            background: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05), 0 2px 4px -2px rgb(0 0 0 / 0.05);
            border: 1px solid #e2e8f0;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.08), 0 4px 6px -4px rgb(0 0 0 / 0.08);
        }
        .chart-container {
            position: relative;
            width: 100%;
            height: 400px;
            max-height: 50vh;
        }
        .tab-button.active {
            background-color: #1d4ed8;
            color: white;
            border-color: #1d4ed8;
        }
        .kpi-table th {
            background-color: #eef2ff;
        }
        .gemini-modal {
            display: none;
        }
        .gemini-modal.show {
            display: flex;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #1d4ed8;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="antialiased">

    <header class="bg-white/95 backdrop-blur-lg shadow-sm sticky top-0 z-50">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-20">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-slate-800">MES BOX 2025-2026 作戰指揮中心</h1>
                </div>
                <nav id="main-nav" class="hidden md:flex space-x-8">
                    <a href="#annual" class="nav-link font-semibold py-6">年度目標</a>
                    <a href="#strategy" class="nav-link font-semibold py-6">核心策略</a>
                    <a href="#quarterly" class="nav-link font-semibold py-6">季度/月份計畫</a>
                </nav>
            </div>
        </div>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">

        <!-- Annual View -->
        <section id="annual" class="content-section mb-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-black text-blue-700 mb-4">年度目標與策略框架 (Annual Goals)</h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-600">定義我們的戰略高度，並將其轉化為具體、可衡量的年度成功指標。</p>
            </div>
            <div class="card p-6 md:p-8 mb-8">
                <h3 class="font-bold text-2xl text-center text-slate-800 mb-4">終極目的 (Objective)</h3>
                <p class="text-center text-xl text-slate-600 max-w-4xl mx-auto leading-relaxed">
                    賦能台灣中小型與創新型製造業，成為其最信賴的數據驅動決策夥伴，並透過提供「OT+IT」整合方案，奠定市場領導者基礎。
                </p>
            </div>
            <div class="card p-6 md:p-8">
                <h3 class="font-bold text-xl text-slate-800 mb-4">2025 年度量化總目標 (Goals)</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center mb-8">
                    <div class="bg-green-50 p-4 rounded-lg">
                        <p class="text-gray-500">年度總業績</p>
                        <p class="text-4xl font-extrabold text-green-600 my-2">NT$ 30,000,000</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <p class="text-gray-500">年度總銷售套數</p>
                        <p class="text-4xl font-extrabold text-blue-600 my-2">100 套</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <p class="text-gray-500">年度總商機</p>
                        <p class="text-4xl font-extrabold text-yellow-600 my-2">300 件</p>
                    </div>
                </div>
                <h3 class="font-bold text-xl text-slate-800 mb-4 mt-8">2025年季度目標分解</h3>
                <p class="text-slate-600 mb-6">將年度總目標拆解至各季度，以視覺化方式呈現全年的業績、套數與商機數的增長節奏。Q1為奠基期，目標為0，從Q2開始加速。</p>
                <div class="chart-container mx-auto max-w-4xl"><canvas id="quarterlyGoalsChart"></canvas></div>
            </div>
        </section>

        <!-- Strategy View -->
        <section id="strategy" class="content-section mb-20">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-black text-blue-700 mb-4">核心策略與強化方案 (Strategies)</h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-600">我們的行動由三大核心策略驅動，確保目標的穩健達成。</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div class="card p-6 flex flex-col">
                    <h3 class="font-bold text-xl text-blue-700 mb-3">策略一：從「產品銷售」轉向「方案路徑銷售」</h3>
                    <p class="text-sm text-slate-600 mb-4 flex-grow">將導入流程本身產品化，銷售一個風險可控、成果可見的「旅程」，以此化解客戶的採購焦慮。</p>
                    <div class="space-y-4 text-sm">
                        <div class="bg-slate-50 p-3 rounded-lg">
                            <p class="font-semibold">行動 1: 制度化「先導-採購」模式</p>
                            <p class="mt-1 text-slate-500">以標準化、付費的「MES BOX先導專案」作為新客戶入門方式。</p>
                            <p class="mt-2 font-medium text-blue-600">KPI: 每月啟動 ≥ 2個；轉換率 ≥ 70%。</p>
                        </div>
                        <div class="bg-slate-50 p-3 rounded-lg">
                            <p class="font-semibold">行動 2: 設計清晰的「升級路徑」</p>
                            <p class="mt-1 text-slate-500">向客戶展示從先導專案到IIoT整合方案的清晰藍圖。</p>
                            <p class="mt-2 font-medium text-blue-600">KPI: 提案覆蓋率 ≥ 90%；向上銷售營收佔比 ≥ 15%。</p>
                        </div>
                    </div>
                </div>
                <div class="card p-6 flex flex-col">
                    <h3 class="font-bold text-xl text-blue-700 mb-3">策略二：從「內容行銷」升級為「主動式商機引擎」</h3>
                    <p class="text-sm text-slate-600 mb-4 flex-grow">建立一套主動出擊、可規模化的商機獲取系統，為銷售漏斗注入高品質潛在客戶。</p>
                    <div class="space-y-4 text-sm">
                        <div class="bg-slate-50 p-3 rounded-lg">
                            <p class="font-semibold">行動 1: 啟動「目標百戶」ABM計畫</p>
                            <p class="mt-1 text-slate-500">篩選百大潛力企業名單，進行立體化、持續性開發。</p>
                            <p class="mt-2 font-medium text-blue-600">KPI: 每月有效互動 ≥ 5家；半年產生合格商機 ≥ 10個。</p>
                        </div>
                        <div class="bg-slate-50 p-3 rounded-lg">
                            <p class="font-semibold">行動 2: 推出「數位轉型健檢」服務</p>
                            <p class="mt-1 text-slate-500">提供免費30分鐘線上診斷，篩選高意向客戶並建立專業形象。</p>
                            <p class="mt-2 font-medium text-blue-600">KPI: 每月完成 ≥ 10次；轉SQL比率 ≥ 40%。</p>
                        </div>
                         <div class="bg-slate-50 p-3 rounded-lg">
                            <p class="font-semibold">行動 3: 加速深化通路夥伴計畫</p>
                            <p class="mt-1 text-slate-500">提前至Q1啟動，目標H1結束前簽訂5家活躍夥伴。</p>
                            <p class="mt-2 font-medium text-blue-600">KPI: 簽署夥伴 ≥ 5家；夥伴貢獻商機比例 ≥ 30%。</p>
                        </div>
                    </div>
                </div>
                <div class="card p-6 flex flex-col">
                    <h3 class="font-bold text-xl text-blue-700 mb-3">策略三：從「補助顧問」進化為「財務價值架構師」</h3>
                    <p class="text-sm text-slate-600 mb-4 flex-grow">將戰術優勢升級為戰略壁壘，為客戶擘劃整體的「財務效益藍圖」，建立對手難以跨越的專業門檻。</p>
                    <div class="space-y-4 text-sm">
                        <div class="bg-slate-50 p-3 rounded-lg">
                            <p class="font-semibold">行動 1: 開發「整合效益試算器」</p>
                            <p class="mt-1 text-slate-500">整合營運效益、政府補助與稅務抵減，產出完整財務效益報告(TCO, ROI)。</p>
                            <p class="mt-2 font-medium text-blue-600">KPI: 銷售使用覆蓋率 ≥ 80%；平均成交金額提升 15%。</p>
                        </div>
                        <div class="bg-slate-50 p-3 rounded-lg">
                            <p class="font-semibold">行動 2: 導入「價值工程」銷售階段</p>
                            <p class="mt-1 text-slate-500">在報價前，與客戶共同完成效益匡算，提交效益分析報告，建立價值共識。</p>
                            <p class="mt-2 font-medium text-blue-600">KPI: 進入此階段商機比例 ≥ 50%；成交率高於平均 20%。</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quarterly & Monthly View -->
        <section id="quarterly" class="content-section">
            <div class="text-center mb-12">
                <h2 class="text-3xl md:text-4xl font-black text-blue-700 mb-4">2025 季度 / 月份執行計畫 (Measures)</h2>
                <p class="max-w-3xl mx-auto text-lg text-slate-600">將年度策略拆解為具體的季度與月份行動方案，確保計畫的可追蹤性與落地執行。點擊下方頁籤切換季度。</p>
            </div>
            <div class="card p-6 md:p-8">
                <div class="flex flex-wrap justify-center border-b border-gray-200 mb-6">
                    <button data-tab="q1" class="tab-button text-lg font-semibold py-3 px-6 rounded-t-lg border-b-2">第一季度 (Q1)</button>
                    <button data-tab="q2" class="tab-button text-lg font-semibold py-3 px-6 rounded-t-lg border-b-2">第二季度 (Q2)</button>
                    <button data-tab="q3" class="tab-button text-lg font-semibold py-3 px-6 rounded-t-lg border-b-2">第三季度 (Q3)</button>
                    <button data-tab="q4" class="tab-button text-lg font-semibold py-3 px-6 rounded-t-lg border-b-2">第四季度 (Q4)</button>
                </div>
                <div id="measures-content">
                    <!-- Quarterly and Monthly content will be injected here -->
                </div>
            </div>
        </section>

    </main>
    
    <!-- Gemini API Modal -->
    <div id="gemini-modal" class="gemini-modal fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h3 id="gemini-modal-title" class="text-xl font-bold">✨ AI 業務助理</h3>
                <button id="gemini-modal-close" class="text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            </div>
            <div id="gemini-modal-content" class="p-6 overflow-y-auto">
                <!-- AI content will be injected here -->
            </div>
            <div id="gemini-modal-loader" class="p-6 text-center hidden">
                <div class="spinner mx-auto"></div>
                <p class="mt-4 text-gray-600">AI 生成中，請稍候...</p>
            </div>
        </div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    // --- Data Definitions ---
    const quarterlyGoalsData = {
        labels: ['Q1', 'Q2', 'Q3', 'Q4'],
        datasets: [
            {
                type: 'bar',
                label: '季度業績目標 (萬元)',
                data: [0, 800, 1000, 1200],
                backgroundColor: 'rgba(59, 130, 246, 0.6)',
                borderColor: '#3B82F6',
                yAxisID: 'y',
            },
            {
                type: 'line',
                label: '季度套數目標 (套)',
                data: [0, 25, 35, 40],
                borderColor: '#16A34A',
                backgroundColor: '#16A34A',
                tension: 0.2,
                fill: false,
                yAxisID: 'y1',
            },
            {
                type: 'line',
                label: '季度商機目標 (件)',
                data: [0, 80, 110, 110],
                borderColor: '#F59E0B',
                backgroundColor: '#F59E0B',
                tension: 0.2,
                fill: false,
                yAxisID: 'y1',
            }
        ]
    };

    const measuresData = {
        q1: {
            target: 'NT$ 0',
            unitsTarget: 0,
            oppsTarget: 0,
            strategy: '奠基與引擎啟動期',
            months: [
                { name: '一月', task: '奠定基礎建設', revenueTarget: 0, unitsTarget: 0, oppsTarget: 0, marketingActions: '1. 官網上線「數位轉型健檢」預約服務。<br>2. 發布《MES白皮書》。', salesActions: '1. **啟動ABM計畫:** 篩選百大潛力企業名單。<br>2. **開發銷售工具:** 完成「整合效益試算器」V1.0。<br>3. **加速夥伴計畫:** 提前啟動通路夥伴洽談。', kpi: '<strong>領先:</strong> 完成健檢≥2次；試算器V1.0完成；接觸潛在夥伴≥3家。<br><strong>滯後:</strong> 「目標百戶」名單完成。' },
                { name: '二月', task: '啟動商機引擎', revenueTarget: 0, unitsTarget: 0, oppsTarget: 0, marketingActions: '1. 推出「零成本導入」補助案行銷活動。<br>2. 推廣「數位轉型健檢」服務。', salesActions: '1. **執行ABM計畫:** 針對目標百戶進行首次接觸。<br>2. **執行健檢服務:** 將預約客戶轉化為SQL。<br>3. **銷售「先導專案」:** 以「低風險、成果可見」為訴求，銷售首批付費先導專案。', kpi: '<strong>領先:</strong> ABM有效互動≥5家；完成健檢≥5次。<br><strong>滯後:</strong> 簽訂「先導專案」≥2個；成功媒合補助案≥5件。' },
                { name: '三月', task: '市場預熱與價值驗證', revenueTarget: 0, unitsTarget: 0, oppsTarget: 0, marketingActions: '1. 舉辦首場線上研討會「你的工廠白忙了嗎？」。<br>2. 製作「先導專案」標準化銷售材料。', salesActions: '1. **商機轉化:** 追蹤研討會MQL，轉化為SQL並預約Demo。<br>2. **導入價值工程:** 針對成熟商機，首次導入「價值工程」銷售階段，與客戶共創效益報告。<br>3. **簽訂夥伴:** 簽訂首批通路合作夥伴。', kpi: '<strong>領先:</strong> 研討會報名≥50人；進入價值工程階段商機≥2個。<br><strong>滯後:</strong> 簽署活躍推薦夥伴≥2家；「先導專案」轉換率≥50%。' }
            ]
        },
        q2: {
            target: 'NT$ 800萬',
            unitsTarget: 25,
            oppsTarget: 80,
            strategy: '加速與價值展示期',
            months: [
                { name: '四月', task: '汽車場景Demo與深化', revenueTarget: 200, unitsTarget: 6, oppsTarget: 25, marketingActions: '1. 製作汽車零件產業成功案例。<br>2. 宣傳整合方案線上發表會。', salesActions: '1. **擴大價值工程:** 全面導入「效益試算器」與價值工程銷售階段。<br>2. **聯合Webinar:** 與風巽達舉辦汽車場景Webinar。<br>3. **轉化先導專案:** 將Q1成功的先導專案客戶，依「升級路徑」轉為年度合約。', kpi: '<strong>領先:</strong> 銷售提案中效益試算器覆蓋率≥80%。<br><strong>滯後:</strong> Standard方案銷售≥4套；先導專案轉年度合約≥1個。' },
                { name: '五月', task: '食品場景Demo與進攻', revenueTarget: 250, unitsTarget: 8, oppsTarget: 25, marketingActions: '1. 準備整合方案技術白皮書。<br>2. 邀請客戶參與Beta測試。', salesActions: '1. **突破Enterprise:** 主管陪同，推動首批Enterprise方案。<br>2. **主題進攻:** 向食品包裝業推廣整合方案。<br>3. **夥伴賦能:** 為已簽約夥伴提供首次培訓。', kpi: '<strong>領先:</strong> 簽署夥伴≥5家(累計)；完成夥伴培訓。<br><strong>滯後:</strong> 簽訂Enterprise合約≥2份。' },
                { name: '六月', task: '商業推廣與試點落地', revenueTarget: 350, unitsTarget: 11, oppsTarget: 30, marketingActions: '1. 發布新聞稿，預告IIoT+MES整合方案。<br>2. 製作正式報價單與合約。', salesActions: '1. **試點部署:** 啟動整合方案的客戶現場試點部署。<br>2. **展前預熱:** 寄發展會邀請函。<br>3. **H1複盤:** 檢討三大強化策略的KPIs達成狀況。', kpi: '<strong>領先:</strong> 預約展會洽談≥15個。<br><strong>滯後:</strong> 簽訂整合方案試點合約≥1份；夥伴貢獻商機比例≥30%。' }
            ]
        },
        q3: {
            target: 'NT$ 1,000萬',
            unitsTarget: 35,
            oppsTarget: 110,
            strategy: '整合方案上市、決戰大展 暨 市場教育',
            months: [
                { name: '七月', task: '整合方案正式上市', revenueTarget: 300, unitsTarget: 10, oppsTarget: 35, marketingActions: '1. 舉辦大型線上發表會。<br>2. 投放數位廣告，主打目標產業。', salesActions: '1. **全面推廣:** 全面啟動整合方案銷售，主攻Enterprise。<br>2. **展前衝刺:** 全員電話預熱。<br>3. **夥伴協同:** 透過合作夥伴轉介商機。', kpi: '<strong>領先:</strong> 發表會出席≥100人；夥伴轉介商機≥5個。<br><strong>滯後:</strong> 整合方案創造有效商機≥10個。' },
                { name: '八月', task: '決戰大展 (自動化展)', revenueTarget: 400, unitsTarget: 15, oppsTarget: 40, marketingActions: '1. 發表更多成功案例。<br>2. 在專業媒體發布技術文章。', salesActions: '1. **攤位展示:** 強打整合方案Demo。<br>2. **現場收單:** 推出展場限定優惠。<br>3. **聯合拜訪:** 安排「卓碼業務+風巽達技術」的聯合拜訪。', kpi: '<strong>領先:</strong> 展場收集名片≥150張；預約後續拜訪≥10次。<br><strong>滯後:</strong> 現場簽訂LOI≥2份。' },
                { name: '九月', task: '收網追擊與夥伴簽約', revenueTarget: 300, unitsTarget: 10, oppsTarget: 35, marketingActions: '1. 推出限時評估優惠。<br>2. 透過夥伴轉介商機。', salesActions: '1. **名單追蹤:** 2週內完成所有展會名單追蹤。<br>2. **簽訂夥伴:** 簽訂第一份白牌(OEM)合約。<br>3. **價值升級:** 向既有客戶推銷升級。', kpi: '<strong>領先:</strong> 100%展會A級名單追蹤完成。<br><strong>滯後:</strong> 轉化展會潛客簽約≥5家；夥伴營收貢獻達50萬。' }
            ]
        },
        q4: {
            target: 'NT$ 1,200萬',
            unitsTarget: 40,
            oppsTarget: 110,
            strategy: '擴大市佔、年度衝刺 暨 客戶價值深化',
            months: [
                { name: '十月', task: '年底促案與內容發表', revenueTarget: 350, unitsTarget: 12, oppsTarget: 35, marketingActions: '1. 發表技術白皮書。<br>2. 舉辦小型線上座談會。', salesActions: '1. **追加銷售:** 銷售AI等加值模組。<br>2. **年底優惠:** 推出「年底前簽約，加贈顧問時數」。<br>3. **把握補助案:** 進行最後一波補助案推廣。', kpi: '<strong>領先:</strong> 白皮書下載≥200次；主管陪同拜訪≥5次。<br><strong>滯後:</strong> 加值服務銷售達50萬；月度簽約數≥5家。' },
                { name: '十一月', task: '鎖定企業預算', revenueTarget: 450, unitsTarget: 15, oppsTarget: 40, marketingActions: '1. 推出「2026年度預算早鳥優惠」。<br>2. 收集客戶滿意度回饋。', salesActions: '1. **強力追蹤:** 協助客戶將Enterprise方案納入下年度預算。<br>2. **客戶關懷:** 進行滿意度訪談，挖掘增購需求。', kpi: '<strong>領先:</strong> 完成100%新客戶訪談；產生增購機會≥3個。<br><strong>滯後:</strong> 確保年度Enterprise 20套目標達成。' },
                { name: '十二月', task: '收尾與規劃', revenueTarget: 400, unitsTarget: 13, oppsTarget: 35, marketingActions: '1. 舉辦年度客戶感謝祭。<br>2. 規劃2026年計畫。', salesActions: '1. **合約收尾:** 完成最後訂單簽署。<br>2. **年度總結:** 召開業務總結會議，檢討OGSM。<br>3. **舉辦感謝會:** 邀請風巽達等夥伴參加。', kpi: '<strong>領先:</strong> 提出2026年業績增長20%策略草案。<br><strong>滯後:</strong> 年度總業績達成率≥100%。' }
            ]
        }
    };

    // --- Navigation Logic ---
    const navLinks = document.querySelectorAll('#main-nav a');
    const sections = document.querySelectorAll('.content-section');
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                navLinks.forEach(link => {
                    link.classList.toggle('active', link.getAttribute('href') === '#' + entry.target.id);
                });
            }
        });
    }, { rootMargin: "-30% 0px -70% 0px" });
    sections.forEach(section => observer.observe(section));

    // --- Chart.js Initialization ---
    Chart.register(ChartDataLabels);
    
    new Chart(document.getElementById('quarterlyGoalsChart'), {
        type: 'bar',
        data: quarterlyGoalsData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { position: 'top' },
                tooltip: { mode: 'index', intersect: false },
            },
            scales: {
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    title: { display: true, text: '業績 (萬元)' },
                    beginAtZero: true
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    title: { display: true, text: '套數 / 商機數' },
                    grid: { drawOnChartArea: false },
                    beginAtZero: true
                }
            }
        }
    });

    // --- Measures Tabs Logic ---
    const tabButtons = document.querySelectorAll('.tab-button');
    const measuresContent = document.getElementById('measures-content');
    function renderMeasuresContent(quarterKey) {
        const data = measuresData[quarterKey];
        let monthsHTML = '';
        data.months.forEach(month => {
            monthsHTML += `
                <div class="mb-6 pb-6 border-b last:border-b-0">
                    <div class="md:flex justify-between items-baseline mb-2">
                        <h4 class="text-lg font-bold text-blue-800">${month.name} - ${month.task}</h4>
                        <div class="text-sm text-slate-500 font-semibold mt-1 md:mt-0">
                            業績目標: ${month.revenueTarget}萬 | 套數目標: ${month.unitsTarget}套 | 商機目標: ${month.oppsTarget}件
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-2 text-sm">
                        <div class="md:col-span-1 bg-slate-50 p-3 rounded-lg">
                            <p class="font-semibold mb-1">行銷活動 (Marketing):</p>
                            <div class="text-slate-600 space-y-1">${month.marketingActions}</div>
                        </div>
                        <div class="md:col-span-1 bg-slate-50 p-3 rounded-lg">
                            <p class="font-semibold mb-1">業務活動 (Sales):</p>
                            <div class="text-slate-600 space-y-1">${month.salesActions}</div>
                        </div>
                        <div class="md:col-span-1 bg-blue-50 p-3 rounded-lg">
                            <p class="font-semibold mb-1">檢核指標 (KPIs):</p>
                            <div class="text-slate-600">${month.kpi}</div>
                        </div>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button class="ai-assistant-btn bg-blue-600 text-white text-sm font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2" data-context='${JSON.stringify(month)}'>
                            ✨ AI 業務助理
                        </button>
                    </div>
                </div>
            `;
        });

        measuresContent.innerHTML = `
            <div class="bg-blue-50 p-4 rounded-lg mb-6 text-center">
                <h3 class="font-bold text-blue-800">季度策略: ${data.strategy}</h3>
                <p class="text-sm text-blue-700 mt-1 font-semibold">季度總目標 &raquo; 業績: ${data.target} | 銷售套數: ${data.unitsTarget}套 | 商機數: ${data.oppsTarget}件</p>
            </div>
            <div>
                ${monthsHTML}
            </div>
        `;
        
        document.querySelectorAll('.ai-assistant-btn').forEach(button => {
            button.addEventListener('click', () => {
                const context = JSON.parse(button.dataset.context);
                openAIAssistantModal(context);
            });
        });
    }
    tabButtons.forEach(button => {
        button.addEventListener('click', () => {
            tabButtons.forEach(btn => btn.classList.remove('active'));
            button.classList.add('active');
            renderMeasuresContent(button.dataset.tab);
        });
    });

    // --- Gemini API Integration ---
    const modal = document.getElementById('gemini-modal');
    const modalTitle = document.getElementById('gemini-modal-title');
    const modalContent = document.getElementById('gemini-modal-content');
    const modalLoader = document.getElementById('gemini-modal-loader');
    const modalCloseBtn = document.getElementById('gemini-modal-close');

    modalCloseBtn.addEventListener('click', () => modal.classList.remove('show'));
    modal.addEventListener('click', (e) => { if(e.target === modal) modal.classList.remove('show'); });

    async function callGeminiAPI(prompt) {
        modalContent.innerHTML = '';
        modalLoader.style.display = 'block';
        
        let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
        const payload = { contents: chatHistory };
        const apiKey = ""; 
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            if (!response.ok) {
                throw new Error(`API 請求失敗，狀態碼： ${response.status}`);
            }
            const result = await response.json();
            if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                const text = result.candidates[0].content.parts[0].text;
                modalContent.innerHTML = `<pre class="whitespace-pre-wrap text-sm leading-relaxed">${text}</pre>`;
            } else {
                throw new Error('從 API 收到的回應格式不正確。');
            }
        } catch (error) {
            modalContent.innerHTML = `<div class="text-red-500">無法生成內容：<br>${error.message}</div>`;
        } finally {
            modalLoader.style.display = 'none';
        }
    }

    function openAIAssistantModal(context) {
        modalTitle.textContent = `✨ ${context.name} AI 業務助理`;
        modalContent.innerHTML = `
            <p class="mb-4">請選擇您需要 AI 協助的項目：</p>
            <div class="flex flex-col space-y-3">
                <button class="ai-option-btn bg-gray-200 hover:bg-gray-300 p-3 rounded-lg text-left" data-type="email"><strong>生成銷售郵件草稿：</strong>根據本月策略，生成一封專業的開發信。</button>
                <button class="ai-option-btn bg-gray-200 hover:bg-gray-300 p-3 rounded-lg text-left" data-type="talking_points"><strong>生成電話溝通要點：</strong>生成一份電話銷售腳本的關鍵溝通要點。</button>
            </div>
        `;
        modal.classList.add('show');

        document.querySelectorAll('.ai-option-btn').forEach(button => {
            button.addEventListener('click', () => {
                const type = button.dataset.type;
                let prompt = '';
                const planContext = `我的公司是卓碼資訊，銷售MES BOX系統。目前的銷售計畫如下：\n月份：${context.name}\n核心任務：${context.task}\n行銷活動：${context.marketingActions.replace(/<br>/g, ' ')}\n業務活動：${context.salesActions.replace(/<br>/g, ' ')}\n檢核指標：${context.kpi.replace(/<br>/g, ' ')}`;

                if (type === 'email') {
                    prompt = `你是一位專業的B2B軟體業務，專門銷售MES系統給台灣的中小製造業。請根據以下的銷售計畫內容，為我草擬一封專業、吸引人且目標明確的開發郵件。郵件的目的是要引起潛在客戶的興趣，並促成一次15分鐘的線上會議來進一步了解他們的需求。\n\n${planContext}`;
                } else if (type === 'talking_points') {
                    prompt = `你是一位頂尖的MES銷售顧問。請根據以下的銷售計畫內容，為我生成一份電話開發時的「關鍵溝通要點」。內容需要包含開場白、點出客戶可能的痛點、我們的解決方案如何幫助他們，以及最終的行動呼籲（Call to Action）。\n\n${planContext}`;
                }
                callGeminiAPI(prompt);
            });
        });
    }


    // --- Initial Render ---
    document.querySelector('.tab-button[data-tab="q1"]').click();
});
</script>

</body>
</html>
